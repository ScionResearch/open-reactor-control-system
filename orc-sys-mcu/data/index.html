<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open Reactor Control System</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Open Reactor Control System</h1>
            <img src="Scion-Logo-260x65.png" alt="Scion Logo" style="height:65px;" />
        </header>
        <nav class="tabs">
            <button class="tab-link active" onclick="openTab(event, 'dashboard')">Dashboard</button>
            <button class="tab-link" onclick="openTab(event, 'control')">Control</button>
            <button class="tab-link" onclick="openTab(event, 'graphs')">Graphs</button>
            <button class="tab-link" onclick="openTab(event, 'filemanager')">File Manager</button>
            <button class="tab-link" onclick="openTab(event, 'system')">System</button>
            <button class="tab-link" onclick="openTab(event, 'settings')">Settings</button>
        </nav>

        <main id="main-content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2>Live Status & Controls</h2>
                <div class="dashboard-grid">
                    <!-- Temperature Card -->
                    <div class="card">
                        <h3>Temperature</h3>
                        <p class="sensor-reading"><span id="temp-reading">--</span> &deg;C</p>
                        <div class="control-group">
                            <label for="temp-setpoint">Setpoint (&deg;C)</label>
                            <input type="number" id="temp-setpoint" step="0.1">
                            <label class="switch">
                                <input type="checkbox" id="temp-enabled">
                                <span class="slider"></span>
                            </label>
                            <button onclick="saveControl('temperature')">Save</button>
                        </div>
                    </div>
                    <!-- pH Card -->
                    <div class="card">
                        <h3>pH</h3>
                        <p class="sensor-reading"><span id="ph-reading">--</span></p>
                         <div class="control-group">
                            <label for="ph-setpoint">Setpoint</label>
                            <input type="number" id="ph-setpoint" step="0.01">
                             <label class="switch">
                                <input type="checkbox" id="ph-enabled">
                                <span class="slider"></span>
                            </label>
                            <button onclick="saveControl('ph')">Save</button>
                        </div>
                    </div>
                    <!-- Dissolved Oxygen Card -->
                     <div class="card">
                        <h3>Dissolved Oxygen</h3>
                        <p class="sensor-reading"><span id="do-reading">--</span> %</p>
                    </div>
                    <!-- Add more cards for other sensors here -->
                </div>
            </div>

            <!-- Graphs Tab -->
            <div id="graphs" class="tab-content">
                <h2>Data Graphs</h2>
                <canvas id="sensorChart"></canvas>
            </div>
            
            <!-- Control Tab -->
            <div id="control" class="tab-content">
                <h2>Reactor Control</h2>
                <div class="control-grid">
                    <div class="control-card">
                        <h3>Temperature Control</h3>
                        <div class="control-form">
                            <div class="form-group">
                                <label for="temp-setpoint-ctrl">Setpoint (Â°C):</label>
                                <input type="number" id="temp-setpoint-ctrl" min="0" max="100" step="0.1" value="37.0">
                            </div>
                            <div class="form-group">
                                <label for="temp-enabled-ctrl">Enabled:</label>
                                <input type="checkbox" id="temp-enabled-ctrl">
                            </div>
                            <div class="pid-params">
                                <div class="form-group">
                                    <label for="temp-kp">Kp:</label>
                                    <input type="number" id="temp-kp" min="0" step="0.1" value="1.0">
                                </div>
                                <div class="form-group">
                                    <label for="temp-ki">Ki:</label>
                                    <input type="number" id="temp-ki" min="0" step="0.01" value="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="temp-kd">Kd:</label>
                                    <input type="number" id="temp-kd" min="0" step="0.01" value="0.01">
                                </div>
                            </div>
                            <button id="temp-save" class="control-btn">Save</button>
                        </div>
                    </div>
                    
                    <div class="control-card">
                        <h3>pH Control</h3>
                        <div class="control-form">
                            <div class="form-group">
                                <label for="ph-setpoint-ctrl">Setpoint:</label>
                                <input type="number" id="ph-setpoint-ctrl" min="0" max="14" step="0.1" value="7.0">
                            </div>
                            <div class="form-group">
                                <label for="ph-enabled-ctrl">Enabled:</label>
                                <input type="checkbox" id="ph-enabled-ctrl">
                            </div>
                            <div class="form-group">
                                <label for="ph-period">Period (s):</label>
                                <input type="number" id="ph-period" min="0" step="1" value="60">
                            </div>
                            <div class="form-group">
                                <label for="ph-max-dose">Max Dose (s):</label>
                                <input type="number" id="ph-max-dose" min="0" step="0.1" value="5.0">
                            </div>
                            <button id="ph-save" class="control-btn">Save</button>
                        </div>
                    </div>
                    
                    <div class="control-card">
                        <h3>Dissolved Oxygen Control</h3>
                        <div class="control-form">
                            <div class="form-group">
                                <label for="do-setpoint-ctrl">Setpoint (mg/L):</label>
                                <input type="number" id="do-setpoint-ctrl" min="0" max="20" step="0.1" value="6.0">
                            </div>
                            <div class="form-group">
                                <label for="do-enabled-ctrl">Enabled:</label>
                                <input type="checkbox" id="do-enabled-ctrl">
                            </div>
                            <div class="pid-params">
                                <div class="form-group">
                                    <label for="do-kp">Kp:</label>
                                    <input type="number" id="do-kp" min="0" step="0.1" value="1.0">
                                </div>
                                <div class="form-group">
                                    <label for="do-ki">Ki:</label>
                                    <input type="number" id="do-ki" min="0" step="0.01" value="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="do-kd">Kd:</label>
                                    <input type="number" id="do-kd" min="0" step="0.01" value="0.01">
                                </div>
                            </div>
                            <button id="do-save" class="control-btn">Save</button>
                        </div>
                    </div>
                    
                    <div class="control-card">
                        <h3>Stirrer Control</h3>
                        <div class="control-form">
                            <div class="form-group">
                                <label for="stirrer-setpoint">Setpoint (RPM):</label>
                                <input type="number" id="stirrer-setpoint" min="0" max="1000" step="10" value="200">
                            </div>
                            <div class="form-group">
                                <label for="stirrer-enabled">Enabled:</label>
                                <input type="checkbox" id="stirrer-enabled">
                            </div>
                            <div class="pid-params">
                                <div class="form-group">
                                    <label for="stirrer-kp">Kp:</label>
                                    <input type="number" id="stirrer-kp" min="0" step="0.1" value="1.0">
                                </div>
                                <div class="form-group">
                                    <label for="stirrer-ki">Ki:</label>
                                    <input type="number" id="stirrer-ki" min="0" step="0.01" value="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="stirrer-kd">Kd:</label>
                                    <input type="number" id="stirrer-kd" min="0" step="0.01" value="0.01">
                                </div>
                            </div>
                            <button id="stirrer-save" class="control-btn">Save</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File Manager Tab -->
            <div id="filemanager" class="tab-content">
                <h2>SD Card File Manager</h2>
                <p class="page-description">Browse and download files from the device's SD card.</p>
                
                <div class="file-manager">
                    <div id="sd-status" class="status-message"></div>
                    
                    <div id="path-navigator" class="path-navigator"></div>
                    
                    <div class="file-list">
                        <div class="file-list-header">
                            <div>Name</div>
                            <div>Size</div>
                            <div>Modified</div>
                            <div>Actions</div>
                        </div>
                        <div id="file-list-items" class="file-list-items">
                            <div class="loading">Loading files...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Tab -->
            <div id="system" class="tab-content">
                <h2>System Status</h2>
                <div class="system-header">
                    <p class="page-description">Current status of system components and resources</p>
                    <button id="rebootButton" class="reboot-button">Reboot System</button>
                </div>
                <div class="status-section-grid">
                    <div class="status-card">
                        <h3>Power Supplies</h3>
                        <div class="status-values">
                            <div class="status-item">
                                <span class="label">Main Supply:</span>
                                <span class="value" id="mainVoltage">--V</span>
                                <span class="status" id="mainVoltageStatus">--</span>
                            </div>
                            <div class="status-item">
                                <span class="label">20V Supply:</span>
                                <span class="value" id="v20Voltage">--V</span>
                                <span class="status" id="v20VoltageStatus">--</span>
                            </div>
                            <div class="status-item">
                                <span class="label">5V Supply:</span>
                                <span class="value" id="v5Voltage">--V</span>
                                <span class="status" id="v5VoltageStatus">--</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="status-card">
                        <h3>Real Time Clock</h3>
                        <div class="status-values">
                            <div class="status-item">
                                <span class="label">Status:</span>
                                <span class="status" id="rtcStatus">--</span>
                            </div>
                            <div class="status-item">
                                <span class="label">Time:</span>
                                <span class="value" id="rtcTime">--</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="status-card">
                        <h3>Communications</h3>
                        <div class="status-values">
                            <div class="status-item">
                                <span class="label">IPC Status:</span>
                                <span class="status" id="ipcStatus">--</span>
                            </div>
                            <div class="status-item">
                                <span class="label">MQTT Status:</span>
                                <span class="status" id="mqttStatus">--</span>
                            </div>
                            <div class="status-item">
                                <span class="label">Modbus Status:</span>
                                <span class="status" id="modbusStatus">--</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="status-card">
                        <h3>SD Card</h3>
                        <div class="status-values">
                            <div class="status-item">
                                <span class="label">Status:</span>
                                <span class="status" id="sdStatus">--</span>
                            </div>
                            <div class="status-item" id="sdCapacityContainer">
                                <span class="label">Capacity:</span>
                                <span class="value" id="sdCapacity">-- GB</span>
                            </div>
                            <div class="status-item" id="sdFreeSpaceContainer">
                                <span class="label">Free Space:</span>
                                <span class="value" id="sdFreeSpace">-- GB</span>
                            </div>
                            <div class="status-item" id="sdLogSizeContainer">
                                <span class="label">Log File Size:</span>
                                <span class="value" id="sdLogSize">-- kB</span>
                            </div>
                            <div class="status-item" id="sdSensorSizeContainer">
                                <span class="label">Sensor File Size:</span>
                                <span class="value" id="sdSensorSize">-- kB</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <h2>System Settings</h2>
                <div class="settings-section">
                    <h3>Date and Time</h3>
                    <div class="live-clock">
                        <span id="liveClock"></span>
                    </div>
                    <div class="form-group">
                        <label for="currentDate">Change Date:</label>
                        <input type="date" id="currentDate" pattern="\d{4}-\d{2}-\d{2}">
                    </div>
                    <div class="form-group">
                        <label for="currentTime">Change Time:</label>
                        <input type="time" id="currentTime" step="1">
                    </div>
                    <div class="form-group">
                        <label for="timezone">Timezone:</label>
                        <select id="timezone">
                            <option value="+12:00" selected>UTC+12:00 (Auckland)</option>
                            <option value="+11:00">UTC+11:00 (Solomon Islands)</option>
                            <option value="+10:00">UTC+10:00 (Sydney)</option>
                            <option value="+09:00">UTC+09:00 (Tokyo)</option>
                            <option value="+08:00">UTC+08:00 (Singapore, Beijing)</option>
                            <option value="+07:00">UTC+07:00 (Bangkok)</option>
                            <option value="+06:00">UTC+06:00 (Dhaka)</option>
                            <option value="+05:00">UTC+05:00 (Karachi)</option>
                            <option value="+04:00">UTC+04:00 (Dubai)</option>
                            <option value="+03:00">UTC+03:00 (Moscow, Istanbul)</option>
                            <option value="+02:00">UTC+02:00 (Cairo, Athens)</option>
                            <option value="+01:00">UTC+01:00 (Paris, Berlin)</option>
                            <option value="+00:00">UTC+00:00 (London, Dublin)</option>
                            <option value="-01:00">UTC-01:00 (Cape Verde)</option>
                            <option value="-02:00">UTC-02:00 (South Georgia)</option>
                            <option value="-03:00">UTC-03:00 (Brazil, Argentina)</option>
                            <option value="-04:00">UTC-04:00 (Atlantic Time)</option>
                            <option value="-05:00">UTC-05:00 (Eastern Time)</option>
                            <option value="-06:00">UTC-06:00 (Central Time)</option>
                            <option value="-07:00">UTC-07:00 (Mountain Time)</option>
                            <option value="-08:00">UTC-08:00 (Pacific Time)</option>
                            <option value="-09:00">UTC-09:00 (Alaska)</option>
                            <option value="-10:00">UTC-10:00 (Hawaii)</option>
                            <option value="-11:00">UTC-11:00 (American Samoa)</option>
                            <option value="-12:00">UTC-12:00 (Baker Island)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="enableNTP">Enable NTP</label>
                        <input type="checkbox" id="enableNTP">
                    </div>
                    <div id="ntpStatusContainer" class="form-group" style="display: none;">
                        <div class="form-group">
                            <label>NTP Status:</label>
                            <span id="ntpStatus" class="static-value"></span>
                        </div>
                        <div class="form-group">
                            <label>Last Update:</label>
                            <span id="lastNtpUpdate" class="static-value"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="enableDST">Daylight Saving Time</label>
                        <input type="checkbox" id="enableDST">
                    </div>
                    <button id="saveTimeBtn" class="btn btn-primary">Save Date and Time Settings</button>
                </div>
                
                <div class="settings-section">
                    <h3>Network Configuration</h3>
                    <form id="networkForm">
                        <div class="form-group">
                            <label>IP Configuration:</label>
                            <select id="ipConfig">
                                <option value="dhcp">DHCP</option>
                                <option value="static">Static IP</option>
                            </select>
                        </div>
                        <div id="staticSettings" style="display: none;">
                            <div class="form-group">
                                <label>IP Address:</label>
                                <input type="text" id="ipAddress" 
                                       pattern="^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$"
                                       placeholder="192.168.1.100"
                                       title="Please enter a valid IPv4 address">
                            </div>
                            <div class="form-group">
                                <label>Subnet Mask:</label>
                                <input type="text" id="subnetMask" 
                                       pattern="^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$"
                                       placeholder="255.255.255.0"
                                       title="Please enter a valid subnet mask">
                            </div>
                            <div class="form-group">
                                <label>Gateway:</label>
                                <input type="text" id="gateway" 
                                       pattern="^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$"
                                       placeholder="192.168.1.1"
                                       title="Please enter a valid gateway address">
                            </div>
                            <div class="form-group">
                                <label>DNS Server:</label>
                                <input type="text" id="dns" 
                                       pattern="^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$"
                                       placeholder="8.8.8.8"
                                       title="Please enter a valid DNS server address">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="macAddress">MAC Address:</label>
                            <span id="macAddress" class="static-value"></span>
                        </div>
                        <div class="form-group">
                            <label for="currentIP">Current IP Address:</label>
                            <span id="currentIP" class="static-value"></span>
                        </div>
                        <div class="form-group">
                            <label for="hostName">Hostname:</label>
                            <input type="text" id="hostName" value="open-reactor-tasman">
                        </div>
                        <div class="form-group">
                            <label for="ntpServer">NTP Server:</label>
                            <input type="text" id="ntpServer" value="pool.ntp.org">
                        </div>
                        <button type="submit" id="saveNetworkSettings" class="btn">Save Network Settings</button>
                        <div id="networkStatus" class="status-message"></div>
                    </form>
                </div>
                
                <div class="settings-section">
                    <h3>MQTT Configuration</h3>
                    <form id="mqttForm">
                        <div class="form-group">
                            <label for="mqttBroker">Broker Address:</label>
                            <input type="text" id="mqttBroker" name="mqttBroker" placeholder="e.g., mqtt.example.com">
                        </div>
                        <div class="form-group">
                            <label for="mqttPort">Port:</label>
                            <input type="number" id="mqttPort" name="mqttPort" placeholder="1883" min="1" max="65535">
                        </div>
                        <div class="form-group">
                            <label for="mqttUsername">Username:</label>
                            <input type="text" id="mqttUsername" name="mqttUsername">
                        </div>
                        <div class="form-group">
                            <label for="mqttPassword">Password:</label>
                            <input type="password" id="mqttPassword" name="mqttPassword">
                        </div>
                        <button type="submit" class="btn">Save MQTT Settings</button>
                    </form>
                </div>
            </div>

        </main>
    </div>
    
    <!-- Toast Container for notifications -->
    <div id="toastContainer" class="toast-container"></div>
    
    <!-- Reboot Confirmation Modal -->
    <div id="rebootModal" class="modal-overlay">
        <div class="confirmation-modal">
            <h3>Confirm System Reboot</h3>
            <p>Are you sure you want to reboot the system? This will temporarily disconnect all connections.</p>
            <div class="modal-buttons">
                <button id="cancelReboot" class="modal-cancel">Cancel</button>
                <button id="confirmReboot" class="modal-confirm">Yes, Reboot</button>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>
</body>
</html>